<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
<script src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
<script src="./jquery-2.1.4.min.js"></script>
<link rel="stylesheet" type="text/css" href="./main.css">
<title>TwitterClient</title>
</head>
<body>
<h1>Twitter, Client!</h1>
<input id="searchWord" type="search" placeholder="search account">
<input type="submit" value="検索" onclick="getTwitter();">
<div id="tweetList" ></div>
<script type="text/javascript">
var options = {
  method: "GET",
  apiURL: "https://api.twitter.com/1.1/search/tweets.json?q=",
  count:10,
  consumerKey:"",
  consumerSecret:"",
  accessToken:"",
  tokenSecret:""
};
function getTwitter() {
  var searchWord = document.getElementById('searchWord');
  options.apiURL = options.apiURL + searchWord.value;
  var accessor = {
    consumerSecret: options.consumerSecret,
    tokenSecret: options.tokenSecret
  };
  var message = {
    method: options.method,
    action:options.apiURL,
    parameters: {
      count:options.count,
      oauth_version: "1.0",
      oauth_signature_method: "HMAC-SHA1",
      oauth_consumer_key: options.consumerKey,
      oauth_token: options.accessToken,
      callback: "resultsOutput"
    }
  };
  OAuth.setTimestampAndNonce(message);
  OAuth.SignatureMethod.sign(message,accessor);
  var url = OAuth.addToURL(message.action, message.parameters);
  $.ajax({
    type: message.method,
    url: url,
    dataType: "jsonp",
    jsonp:false,
    cache: true
  });
}

function resultsOutput(data) {
  var statuses = data.statuses;
  var ul = document.createElement("ul");
  ul.setAttribute("class","list");
  for (var i = 0; i < statuses.length; i++) {
    console.log(statuses[i].user.name);
    console.log(statuses[i].user.screen_name);
    console.log(statuses[i].text);
    createTable(ul,statuses[i]);
  }
}

/**
 * spanタグを作成します
 * @param {string} name spanタグに設定するname属性の値
 * @param {string} data spanタグに設定するinnerHTMLの値
 */
function createSpan(name,data) {
  var span = document.createElement("span");
  span.setAttribute("data-name",name);
  span.setAttribute("class","cell");
  span.innerHTML = data;
  return span;
}

function createTable(element,data) {
  var li = document.createElement("li");
  li.setAttribute("id", "tweet");
  var span1 = createSpan("name",data.user.name);
  var span2 = createSpan("screen_name",data.user.screen_name);
  var span3 = createSpan("text",data.text);
  li.appendChild(span1);
  li.appendChild(span2);
  li.appendChild(span3);
  element.appendChild(li);
  var div = document.getElementById("tweetList");
  div.appendChild(element);
}
</script>
</body>
</html>